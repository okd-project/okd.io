<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The Community Distribution of Kubernetes that powers Red Hat OpenShift"><meta name=author content="Brian Innes"><link href=https://openshift-cs.github.io/okd.io/index.html/blog/2020/08/31/okd_virtualization_on_user_provided_infrastructure/ rel=canonical><link href=../prerequisites_for_vsphere_upi/ rel=next><link rel=icon href=../../../../../img/okdLogo.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.6"><title>OKD Virtualization on user provided infrastructure - OKD.io</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.35e1ed30.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.356b1318.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Open Sans";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../css/extra.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="OKD Virtualization on user provided infrastructure - OKD.io"><meta property=og:description content="The Community Distribution of Kubernetes that powers Red Hat OpenShift"><meta property=og:image content=https://openshift-cs.github.io/okd.io/index.html/assets/images/social/blog/posts/guides/virt-baremetal-upi/index.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=https://openshift-cs.github.io/okd.io/index.html/blog/2020/08/31/okd_virtualization_on_user_provided_infrastructure/ property=og:url><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="OKD Virtualization on user provided infrastructure - OKD.io"><meta name=twitter:description content="The Community Distribution of Kubernetes that powers Red Hat OpenShift"><meta name=twitter:image content=https://openshift-cs.github.io/okd.io/index.html/assets/images/social/blog/posts/guides/virt-baremetal-upi/index.png></head> <body dir=ltr data-md-color-scheme=okd data-md-color-primary=blue-grey data-md-color-accent=red> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#okd-virtualization-on-user-provided-infrastructure class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title=OKD.io class="md-header__button md-logo" aria-label=OKD.io data-md-component=logo> <img src=../../../../../img/okd_logo_resized.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> OKD.io </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> OKD Virtualization on user provided infrastructure </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=okd data-md-color-primary=blue-grey data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=okd-dark data-md-color-primary=okd-blue data-md-color-accent=okd-light-green aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/okd-project/okd.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> okd-io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title=OKD.io class="md-nav__button md-logo" aria-label=OKD.io data-md-component=logo> <img src=../../../../../img/okd_logo_resized.svg alt=logo> </a> OKD.io </label> <div class=md-nav__source> <a href=https://github.com/okd-project/okd.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> okd-io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../../../about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../../../../crc/ class=md-nav__link> <span class=md-ellipsis> CRC </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../docs/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <a href=../../../../ class=md-nav__link> <span class=md-ellipsis> Posts </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../archive/2023/ class=md-nav__link> <span class=md-ellipsis> 2023 </span> </a> </li> <li class=md-nav__item> <a href=../../../../archive/2022/ class=md-nav__link> <span class=md-ellipsis> 2022 </span> </a> </li> <li class=md-nav__item> <a href=../../../../archive/2021/ class=md-nav__link> <span class=md-ellipsis> 2021 </span> </a> </li> <li class=md-nav__item> <a href=../../../../archive/2020/ class=md-nav__link> <span class=md-ellipsis> 2020 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Community </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Community </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../community/ class=md-nav__link> <span class=md-ellipsis> OKD Community </span> </a> </li> <li class=md-nav__item> <a href=../../../../../conduct/ class=md-nav__link> <span class=md-ellipsis> Code of Conduct </span> </a> </li> <li class=md-nav__item> <a href=../../../../../contributor/ class=md-nav__link> <span class=md-ellipsis> Contributor </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> OKD Working Group </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> OKD Working Group </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../working-groups/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../../../../../charter/ class=md-nav__link> <span class=md-ellipsis> Charter </span> </a> </li> <li class=md-nav__item> <a href=../../../../../communications/ class=md-nav__link> <span class=md-ellipsis> Communications </span> </a> </li> <li class=md-nav__item> <a href=../../../../../working-group/minutes/minutes/ class=md-nav__link> <span class=md-ellipsis> Minutes </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5> <label class=md-nav__link for=__nav_7_5 id=__nav_7_5_label tabindex=0> <span class=md-ellipsis> Subgroups </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_5_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5> <span class="md-nav__icon md-icon"></span> Subgroups </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5_1> <label class=md-nav__link for=__nav_7_5_1 id=__nav_7_5_1_label tabindex=0> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_7_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5_1> <span class="md-nav__icon md-icon"></span> Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../wg_docs/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../../../wg_docs/okd-io/ class=md-nav__link> <span class=md-ellipsis> Modifying OKD.io </span> </a> </li> <li class=md-nav__item> <a href=../../../../../wg_docs/doc-env/ class=md-nav__link> <span class=md-ellipsis> Setup environment </span> </a> </li> <li class=md-nav__item> <a href=../../../../../wg_docs/content/ class=md-nav__link> <span class=md-ellipsis> Content guidelines </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5_2> <label class=md-nav__link for=__nav_7_5_2 id=__nav_7_5_2_label tabindex=0> <span class=md-ellipsis> CRC Build </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_7_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5_2> <span class="md-nav__icon md-icon"></span> CRC Build </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../wg_crc/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5_3> <label class=md-nav__link for=__nav_7_5_3 id=__nav_7_5_3_label tabindex=0> <span class=md-ellipsis> OKD Virtualization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_7_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5_3> <span class="md-nav__icon md-icon"></span> OKD Virtualization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../wg_virt/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../../../wg_virt/community/ class=md-nav__link> <span class=md-ellipsis> Community </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> OKD Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> OKD Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../okd_tech_docs/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../../../okd_tech_docs/modifying_okd/ class=md-nav__link> <span class=md-ellipsis> Modifying OKD </span> </a> </li> <li class=md-nav__item> <a href=../../../../../okd_tech_docs/operators/ class=md-nav__link> <span class=md-ellipsis> Operator Hub catalogs </span> </a> </li> <li class=md-nav__item> <a href=../../../../../okd_tech_docs/release/ class=md-nav__link> <span class=md-ellipsis> Release </span> </a> </li> <li class=md-nav__item> <a href=../../../../../okd_tech_docs/troubleshoot/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Help </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../help/ class=md-nav__link> <span class=md-ellipsis> Getting Help </span> </a> </li> <li class=md-nav__item> <a href=../../../../../faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#preparing-the-hardware class=md-nav__link> Preparing the hardware </a> </li> <li class=md-nav__item> <a href=#preparing-the-infrastructure class=md-nav__link> Preparing the infrastructure </a> </li> <li class=md-nav__item> <a href=#provision-your-hosts class=md-nav__link> Provision your hosts </a> </li> <li class=md-nav__item> <a href=#configure-the-bastion-to-host-needed-services class=md-nav__link> Configure the bastion to host needed services </a> </li> <li class=md-nav__item> <a href=#installing-okd class=md-nav__link> Installing OKD </a> </li> <li class=md-nav__item> <a href=#apply-the-workarounds class=md-nav__link> Apply the workarounds </a> </li> <li class=md-nav__item> <a href=#installing-hco-and-kubevirt class=md-nav__link> Installing HCO and KubeVirt </a> </li> <li class=md-nav__item> <a href=#providing-storage class=md-nav__link> Providing storage </a> <nav class=md-nav aria-label="Providing storage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#shared-storage class=md-nav__link> Shared storage </a> </li> <li class=md-nav__item> <a href=#local-storage class=md-nav__link> Local storage </a> <nav class=md-nav aria-label="Local storage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configuring-selinux-for-the-hostpath-provisioner-on-okd-worker-nodes class=md-nav__link> Configuring SELinux for the hostpath provisioner on OKD worker nodes </a> </li> <li class=md-nav__item> <a href=#creating-a-custom-resource-cr-for-the-hostpathprovisioner-operator class=md-nav__link> Creating a custom resource (CR) for the HostPathProvisioner operator </a> </li> <li class=md-nav__item> <a href=#creating-a-storageclass-for-the-hostpathprovisioner-operator class=md-nav__link> Creating a StorageClass for the HostPathProvisioner operator </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content md-content--post" data-md-component=content> <div class="md-sidebar md-sidebar--post" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class="md-sidebar__inner md-post"> <nav class="md-nav md-nav--primary"> <div class=md-post__back> <div class="md-nav__title md-nav__container"> <a href=../../../../ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> <span class=md-ellipsis> Back to index </span> </a> </div> </div> <ul class="md-post__meta md-nav__list"> <li class="md-nav__item md-nav__item--section"> <div class=md-post__title> <span class=md-ellipsis> Metadata </span> </div> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg> <time datetime="2020-08-31 00:00:00" class=md-ellipsis>August 31, 2020</time> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg> <span class=md-ellipsis> 4 min read </span> </div> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <article class="md-content__inner md-typeset"> <h1 id=okd-virtualization-on-user-provided-infrastructure>OKD Virtualization on user provided infrastructure<a class=headerlink href=#okd-virtualization-on-user-provided-infrastructure title="Permanent link">&para;</a></h1> <!--- cSpell:ignore baremetal rpcbind openvswitch kube Virt Hyperconverged hostpath machineconfig kubevirt --> <p>This guide shows how to set up OKD Virtualization</p> <!-- more --> <h2 id=preparing-the-hardware>Preparing the hardware<a class=headerlink href=#preparing-the-hardware title="Permanent link">&para;</a></h2> <p>As a first step for providing an infrastructure for OKD Virtualization, you need to prepare the hardware:</p> <ul> <li>check that the <a href=https://docs.okd.io/latest/installing/installing_bare_metal/installing-bare-metal.html#minimum-resource-requirements_installing-bare-metal>minimum hardware requirements for running OKD</a> are satisfied</li> <li>check that the <a href=https://docs.okd.io/latest/virt/install/preparing-cluster-for-virt.html#virt-cluster-resource-requirements_preparing-cluster-for-virt>additional hardware requirements for running OKD Virtualization</a> are also satisfied.</li> </ul> <h2 id=preparing-the-infrastructure>Preparing the infrastructure<a class=headerlink href=#preparing-the-infrastructure title="Permanent link">&para;</a></h2> <p>Once your hardware is ready and connected to the network you need to configure your services, your network and your DNS for allowing the OKD installer to deploy the software. You may also need to prepare in advance a few services you'll need during the deployment. Carefully read the <a href=https://docs.okd.io/latest/installing/installing_bare_metal/installing-bare-metal.html#installation-infrastructure-user-infra_installing-bare-metal>Preparing the user-provisioned infrastructure</a> section and ensure all the requirements are met.</p> <h2 id=provision-your-hosts>Provision your hosts<a class=headerlink href=#provision-your-hosts title="Permanent link">&para;</a></h2> <p>For the bastion / service host you can use CentOS Stream 8. You can follow the <a href=https://docs.centos.org/en-US/8-docs/standard-install/ >CentOS 8 installation documentation</a> but we recommend using the latest <a href=http://isoredirect.centos.org/centos/8-stream/isos/x86_64/ >CentOS Stream 8 ISO</a>.</p> <p>For the OKD nodes you’ll need Fedora CoreOS. You can get it from the <a href="https://getfedora.org/en/coreos?stream=stable">Get Fedora!</a> website, choose the Bare Metal ISO.</p> <h2 id=configure-the-bastion-to-host-needed-services>Configure the bastion to host needed services<a class=headerlink href=#configure-the-bastion-to-host-needed-services title="Permanent link">&para;</a></h2> <p>Configure Apache to serve on port 8080/8443 as the http/https port will be used by the haproxy service. Apache will be needed to provide ignition configuration for OKD nodes.</p> <div class=highlight><pre><span></span><code>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>httpd
sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/Listen 80/Listen 8080/&#39;</span><span class=w> </span>/etc/httpd/conf/httpd.conf
sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/Listen 443/Listen 8443/&#39;</span><span class=w> </span>/etc/httpd/conf.d/ssl.conf
setsebool<span class=w> </span>-P<span class=w> </span>httpd_read_user_content<span class=w> </span><span class=m>1</span>
systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>--now<span class=w> </span>httpd.service
firewall-cmd<span class=w> </span>--permanent<span class=w> </span>--add-port<span class=o>=</span><span class=m>8080</span>/tcp
firewall-cmd<span class=w> </span>--permanent<span class=w> </span>--add-port<span class=o>=</span><span class=m>8443</span>/tcp
firewall-cmd<span class=w> </span>--reload
<span class=c1># Verify it’s up:</span>
curl<span class=w> </span>localhost:8080
</code></pre></div> <p>Configure haproxy:</p> <div class=highlight><pre><span></span><code>dnf<span class=w> </span>install<span class=w> </span>haproxy<span class=w> </span>-y
firewall-cmd<span class=w> </span>--permanent<span class=w> </span>--add-port<span class=o>=</span><span class=m>6443</span>/tcp
firewall-cmd<span class=w> </span>--permanent<span class=w> </span>--add-port<span class=o>=</span><span class=m>22623</span>/tcp
firewall-cmd<span class=w> </span>--permanent<span class=w> </span>--add-service<span class=o>=</span>http
firewall-cmd<span class=w> </span>--permanent<span class=w> </span>--add-service<span class=o>=</span>https
firewall-cmd<span class=w> </span>--reload
setsebool<span class=w> </span>-P<span class=w> </span>haproxy_connect_any<span class=w> </span><span class=m>1</span>
systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>--now<span class=w> </span>haproxy.service
</code></pre></div> <h2 id=installing-okd>Installing OKD<a class=headerlink href=#installing-okd title="Permanent link">&para;</a></h2> <p>OKD current stable-4 branch is delivering OKD 4.8. If you're using an older version we recommend to update to ODK 4.8.</p> <p>At this point you should have all OKD nodes ready to be installed with Fedora CoreOS and the bastion with all the needed services. Check that all nodes and the bastion have the correct ip addresses and fqdn and that they are resolvable via DNS.</p> <p>As we are going to use the baremetal UPI installation you’ll need to create a <code>install-config.yaml</code> following the example for <a href=https://docs.okd.io/latest/installing/installing_bare_metal/installing-bare-metal.html#installation-bare-metal-config-yaml_installing-bare-metal>installing bare metal</a></p> <p>Remember to <a href=https://docs.okd.io/latest/installing/installing_bare_metal/installing-bare-metal.html#installation-configure-proxy_installing-bare-metal>configure your proxy settings if you have a proxy</a></p> <h2 id=apply-the-workarounds>Apply the workarounds<a class=headerlink href=#apply-the-workarounds title="Permanent link">&para;</a></h2> <ul> <li>qemu-ga is hitting selinux denials <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1927639">https://bugzilla.redhat.com/show_bug.cgi?id=1927639</a></li> </ul> <p>You can workaround this by adding a custom policy: <div class=highlight><pre><span></span><code><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;(allow virt_qemu_ga_t container_var_lib_t (dir (search)))&#39;</span><span class=w> </span>&gt;local_virtqemu_ga.cil
semodule<span class=w> </span>-i<span class=w> </span>local_virtqemu_ga.cil
</code></pre></div></p> <ul> <li>iptables is hitting selinux denials <a href="https://bugzilla.redhat.com/show_bug.cgi?id=2008097">https://bugzilla.redhat.com/show_bug.cgi?id=2008097</a></li> </ul> <p>You can workaround this by adding a custom policy:</p> <div class=highlight><pre><span></span><code><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;(allow iptables_t cgroup_t (dir (ioctl)))&#39;</span><span class=w> </span>&gt;local_iptables.cil
semodule<span class=w> </span>-i<span class=w> </span>local_iptables.cil
</code></pre></div> <ul> <li>rpcbind</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;(allow rpcbind_t unreserved_port_t (udp_socket (name_bind)))&#39;</span><span class=w> </span>&gt;local_rpcbind.cil
semodule<span class=w> </span>-i<span class=w> </span>local_rpcbind.cil
</code></pre></div> <ul> <li>master nodes are failing the first boot with access denied to <code>[::1]:53</code> <a href=https://github.com/okd-project/okd/issues/897>https://github.com/okd-project/okd/issues/897</a></li> </ul> <p>While the master node is booting edit the grub config adding to kernel command line <code>console=null</code>.</p> <ul> <li>worker nodes may fail on openvswitch</li> </ul> <div class=highlight><pre><span></span><code>echo &#39;(allow openvswitch_t init_var_run_t (capability (fsetid)))&#39; &gt;local_openvswitch.cil
semodule -i local_openvswitch.cil
</code></pre></div> <h2 id=installing-hco-and-kubevirt>Installing HCO and KubeVirt<a class=headerlink href=#installing-hco-and-kubevirt title="Permanent link">&para;</a></h2> <p>Once the OKD console is up, connect to it. Go to <strong>Operators</strong> -&gt; <strong>OperatorHub</strong>, look for <code>KubeVirt HyperConverged Cluster Operator</code> and install it.</p> <p>Click on the <strong>Create Hyperconverged</strong> button, all the defaults should be fine.</p> <h2 id=providing-storage>Providing storage<a class=headerlink href=#providing-storage title="Permanent link">&para;</a></h2> <p>Shared storage is not mandatory for OKD Virtualization, but without a doubt it provides many advantages over a configuration based on local storage which is considered a suboptimal configuration.</p> <p>Between the advantages enabled by shared storage it is worth mentioning: - Live migration of Virtual Machines - Founding pillar for HA - Enables seamless cluster upgrades without the need to shut down and restart all the VMs on each upgrade - Centralized storage management enabling elastic scalability - Centralized backup</p> <h3 id=shared-storage>Shared storage<a class=headerlink href=#shared-storage title="Permanent link">&para;</a></h3> <p>TBD: rook.io deployment</p> <h3 id=local-storage>Local storage<a class=headerlink href=#local-storage title="Permanent link">&para;</a></h3> <p>You can configure local storage for your virtual machines by using the OKD Virtualization hostpath provisioner feature.</p> <p>When you install OKD Virtualization, the hostpath provisioner Operator is automatically installed. To use it, you must: - Configure SELinux on your worker nodes via a Machine Config object. - Create a HostPathProvisioner custom resource. - Create a StorageClass object for the hostpath provisioner.</p> <h4 id=configuring-selinux-for-the-hostpath-provisioner-on-okd-worker-nodes>Configuring SELinux for the hostpath provisioner on OKD worker nodes<a class=headerlink href=#configuring-selinux-for-the-hostpath-provisioner-on-okd-worker-nodes title="Permanent link">&para;</a></h4> <p>You can configure SELinux for your OKD Worker nodes using a <a href=../../../../guides/virt-baremetal-upi/contrib/machineconfig-selinux-hpp.yaml>MachineConfig</a>.</p> <h4 id=creating-a-custom-resource-cr-for-the-hostpathprovisioner-operator>Creating a custom resource (CR) for the HostPathProvisioner operator<a class=headerlink href=#creating-a-custom-resource-cr-for-the-hostpathprovisioner-operator title="Permanent link">&para;</a></h4> <ol> <li> <p>Create the HostPathProvisioner custom resource file. For example:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>touch<span class=w> </span>hostpathprovisioner_cr.yaml
</code></pre></div> </li> <li> <p>Edit that file. For example:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hostpathprovisioner.kubevirt.io/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HostPathProvisioner</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hostpath-provisioner</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class=w>  </span><span class=nt>pathConfig</span><span class=p>:</span>
<span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/hpvolumes&quot;</span><span class=w> </span><span class=c1># The path of the directory on the node</span>
<span class=w>    </span><span class=nt>useNamingPrefix</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w> </span><span class=c1># Use the name of the PVC bound to the created PV as part of the directory name.</span>
</code></pre></div> </li> <li> <p>Create the CR in the <code>kubevirt-hyperconverged</code> namespace:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>oc<span class=w> </span>create<span class=w> </span>-n<span class=w> </span>kubevirt-hyperconverged<span class=w> </span>-f<span class=w> </span>hostpathprovisioner_cr.yaml
</code></pre></div> </li> </ol> <h4 id=creating-a-storageclass-for-the-hostpathprovisioner-operator>Creating a StorageClass for the HostPathProvisioner operator<a class=headerlink href=#creating-a-storageclass-for-the-hostpathprovisioner-operator title="Permanent link">&para;</a></h4> <ol> <li> <p>Create the YAML file for the storage class. For example:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>touch<span class=w> </span>hppstorageclass.yaml
</code></pre></div> </li> <li> <p>Edit that file. For example:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hostpath-provisioner</span>
<span class=nt>provisioner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.io/hostpath-provisioner</span>
<span class=nt>reclaimPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Delete</span>
<span class=nt>volumeBindingMode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">WaitForFirstConsumer</span>
</code></pre></div> </li> <li> <p>Creating the Storage Class object:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>oc<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>hppstorageclass.yaml
</code></pre></div> </li> </ol> </article> </div> </div> </main> <!-- Footer --> <footer class=md-footer> <div class=container> <div class=row> <!-- Social Section --> <div class="col-md-4 col-sm-12"> <a href=https://www.redhat.com/ > <img alt="Red Hat" src=https://assets.openshift.com/hubfs/images/logos/Logo-RedHat-A-Reverse-RGB.svg style="width: 128px"> </a> </div> <div class="col-md-4 col-sm-12"> <ul class=social> <li class=twitter> <a href=https://twitter.com/okd_io> <span> <i class="fa fa-twitter-square"></i> </span> </a> </li> <li class=github> <a href=https://github.com/okd-project/okd> <span> <i class="fa fa-github"></i> </span> </a> </li> <li class=google> <a href=https://plus.google.com/communities/114361859072744017486> <span> <i class="fa fa-google-plus-square"></i> </span> </a> </li> <li class=facebook> <a href=https://www.facebook.com/openshift> <span> <i class="fa fa-facebook-square"></i> </span> </a> </li> </ul> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["content.code.copy", "content.code.annotate", "naviagation.sections", "navigation.tracking", "search.suggest", "search.highlight"], "search": "../../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../../../assets/javascripts/bundle.aecac24b.min.js></script> </body> </html>